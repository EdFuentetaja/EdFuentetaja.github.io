<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>Eye Diagram</title>
    <style>
	    html, body {
	        width: 100%;
	        height: 100%;
	        margin: 0px;
	        border: 0;
	        overflow: hidden; /*    Disable scrollbars */
	        display: block;    /* No floating content on sides */
	    }

		.canvas {
			border:1px solid #111111;
			width: calc(100% - 20px);
    		margin-left: 10px;
    		margin-right: 10px;
		}

	    .input_value {
			width: 100px;
			margin-left: 10px;
			margin-right: 10px;
			text-align: right;
		}

	    .slider {
			width: calc(100% - 259px);
			position: relative;
			top: 7px;
		}
    </style>
</head>

<body onload="onPageLoad();">

	<div style="margin: 10px;">
		<input type="file" id="myFileInput" />
	</div>

	<div>
	<canvas id="myCanvas" class="canvas">
	Your browser does not support the HTML5 canvas tag.</canvas>
	</div>

	<div>
    <span style="display: inline;">
		<input type="text" class="input_value" id="mySPSRangeValue" title="Samples per symbol" />
		<input type="range" min="1" max="10" step="0.001" class="slider" id="mySPSRange" />
 	</span>
 	</div>

 	<div>
    <span style="display: inline;">
		<input type="text" class="input_value" id="myOffsetRangeValue" title="Offset" />
		<input type="range" min="-5" max="5" step="0.001" class="slider" id="myOffsetRange" />
 	</span>
 	</div>

<script>

var canvas;
var data;
var sps = 9.873333333;
var offset = 0;

function onPageLoad()
{
	// Check for the various File API support.
	if (window.File && window.FileReader && window.FileList && window.Blob) {
	    // Great success! All the File APIs are supported.
	} else {
	    alert('The File APIs are not fully supported in this browser.');
	}

	document.getElementById('myFileInput').addEventListener('change', readFile, false);

	var mySPSRangeValue = document.getElementById('mySPSRangeValue');
	var mySPSSlider = document.getElementById('mySPSRange');
	var myOffsetRangeValue = document.getElementById('myOffsetRangeValue');
	var myOffsetSlider = document.getElementById('myOffsetRange');

	mySPSRangeValue.value = sps;
	mySPSSlider.value = sps;
	myOffsetRangeValue.value = 0;
	myOffsetSlider.value = 0;
    myOffsetSlider.min = -sps / 2.0;
    myOffsetSlider.max = sps / 2.0;

	mySPSRangeValue.oninput = function() {
		sps = this.value;
	    mySPSSlider.value = this.value;
	    myOffsetSlider.min = -sps / 2.0;
	    myOffsetSlider.max = sps / 2.0;
	    redraw();
	}
	mySPSSlider.oninput = function() {
		sps = this.value;
	    mySPSRangeValue.value = this.value;
	    myOffsetSlider.min = -sps / 2.0;
	    myOffsetSlider.max = sps / 2.0;
	    redraw();
	}

	myOffsetRangeValue.oninput = function() {
		offset = this.value;
	    myOffsetSlider.value = this.value;
	    redraw();
	}
	myOffsetSlider.oninput = function() {
		offset = this.value;
	    myOffsetRangeValue.value = this.value;
	    redraw();
	}

	canvas = document.getElementById('myCanvas');
    var ctx = canvas.getContext("2d");
    //ctx.translate(0.5, 0.5);	// to get 1px lines

    window.addEventListener('resize', resizeCanvas, false);
    // Draw canvas border for the first time.
    resizeCanvas();
}

// Display custom canvas.
// In this case it's a blue, 5 pixel border that
// resizes along with the browser window.
function redraw()
{
    visualize(canvas, data, sps, offset);
}

// Runs each time the DOM window resize event fires.
// Resets the canvas dimensions to match window,
// then draws the new borders accordingly.
function resizeCanvas()
{
    canvas.width = document.body.clientWidth;
    canvas.height = document.body.clientHeight - 110;
    redraw();
}

function readFile(e) {
    var file = e.target.files[0];
    if (!file) {
        return;
    }
    var reader = new FileReader();
    reader.onload = function(e) {
        var contents = e.target.result;
        //var element = document.getElementById('file-content');
        bytes = Uint8Array.from(contents, c => c.charCodeAt(0));
    	data = new Float32Array(bytes.buffer)
    	redraw();
    };
    reader.readAsBinaryString(file);
}

function visualize(canvas, floats, sps, offset)
{
    var ctx = canvas.getContext("2d");

    var w = canvas.width;
    var h = canvas.height;

    ctx.clearRect(0, 0, w, h);

    // Grid
    ctx.strokeStyle = 'grey';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, h/2);
    ctx.lineTo(w, h/2);
    ctx.moveTo(w/2, 0);
    ctx.lineTo(w/2, h);
    ctx.stroke();

	if (!data || data.length == 0) {
		return;
	}

    ctx.strokeStyle = 'rgba(0, 0, 100, 0.25)';
    ctx.lineWidth = '1';

    var y_scale = h/(2.0*Math.PI);
    var x_step = w / sps;
    var x = -x_step * offset;

    ctx.beginPath();
    var prev_y = (h/2.0)-(floats[0]*y_scale);
    ctx.moveTo(x, prev_y);

    for (var sample_index=1; sample_index < floats.length; sample_index++) {
        x += x_step;
        var y = (h/2.0)-(floats[sample_index]*y_scale);
        ctx.lineTo(x, y);
        if (x > w) {
            x -= w;
            ctx.moveTo(x-x_step, prev_y);
            ctx.lineTo(x, y);
        }
        prev_y = y;
    }

    ctx.stroke();
}

</script>

</body>

</html>